<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>API test page</title>
</head>
<body>
    <script>
        async function initIframe() {
            const iframe = document.createElement("iframe");
            iframe.setAttribute("sandbox", "allow-scripts");
            iframe.setAttribute("style", "display: none;");
            iframe.setAttribute("src", "https://alttiri.github.io/gfycat-id-camel-caser/iframe-api.html");

            document.body.append(iframe);
            await new Promise(resolve => {
                iframe.addEventListener("load", resolve);
            });

            let i = 0; const seed = Math.random();
            return async function matchGfyId(wordsString) {
                const id = `gfy-id:${seed}:${i++}`;
                iframe.contentWindow.postMessage({wordsString, id}, "*");
                return new Promise(resolve => {
                    window.addEventListener("message", event => {
                        const {result, from, messageId} = event.data;
                        if (from === "gfy-id-camel-caser" && id === messageId) {
                            resolve(result);
                        }
                    });
                });
            }
        }

        !async function main() {
            const matchGfyId = await initIframe();
            globalThis.matchGfyId = matchGfyId; // for testing in the console

            // The example
            /** @type {MatchResultLike} */
            const result = await matchGfyId("redbluecat");
            console.log("matchGfyId:", result.string);
        }();
    </script>
</body>
</html>
